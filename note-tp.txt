- Créer une équipe sur digitalocean

- Sécuriser le serveur en SSH :
    - Accès à la console en root 
    - useradd -m croquette
    - usermod -aG sudo croquette
    - echo "croquette:teamrocket" | chpasswd 
    - mkdir /home/croquette/.ssh
    - cp /root/.ssh/authorized_keys /home/croquette/.ssh/authorized_keys
    - chown -R croquette:croquette /home/croquette/ 
    - connection sur le user croquette
    - vérification de la clé cat ~/.ssh/authorized_keys
    - sudo vim /etc/ssh/sshd_config 
    - mettre le mot de passe (teamrocket)
    - Dans le fichier : 
        - Changer le port 22 en 2803
        - PermitRootLogin yes en no
        - PasswordAuthentification no
    - sudo systemctl reload sshd

- Désactivation Apache2 : 
    - sudo systemctl stop apache2
    - sudo systemctl disable apache2

- Installation de Docker (https://www.it-connect.fr/installation-pas-a-pas-de-docker-sur-debian-11/) + Git (sudo apt install git-all)
    --> sudo usermod -aG docker croquette

- Création du compose.yml avec nginx, database postgresql et adminer
- Création du default.conf

- Création d'un accès ssh :
    --> ssh-keygen -t rsa -b 4096 (génère clé paire de clé ssh en local sur son terminal)
    --> cat id_ma_cle.pub (affiche le contenu de ma clé publique)
    --> copier le contenu de ma clé publique nouvellement créée
    --> se connecter au droplet depuis digitalocean avec notre user 
    --> vim /.ssh/authorized_keys (ajouter notre clé publique au fichier authorized_keys)
    --> ssh -i  path/to/my/ssh/key/id_ma_cle croquette@165.227.168.148 -p 2803 (se connecter au droplet depuis son terminal local)

- Configuration d'un sous domaine pour adminer : 
    --> Depuis digital ocean > Networking > team-croquette.site > Domain > CNAME > ajouter CNAME
        hostname : adminer
        alias : @ (team-croquette.site)
    --> depuis ovh dans Noms de domaine > team-croquette.site > zone DNS > ajouter une entrée
        type : CNAME 
        sous domaine : adminer
        cible : team-croquette.site
    --> ensuite dans le default.conf rajouter la config suivant :
        server {
            listen 80;
            listen [::]:80;
            server_name adminer.team-croquette.site;

            location / {
                proxy_pass http://adminer:8080;
            }
        }

- Configuration de certbot :
    - Création d'un Dockerfile
    - Ajout du service certbot au compose.yml
    - Modification du service nginx
    - Création du ficher ovh.credentials
    - Lancement : docker compose build certbot && docker compose up


- Renouvellement automatique : 
    - crontab -e
    - 0 12 * * * docker compose run --rm certbot && docker compose restart nginx
        --> Renouvellement tous les jours à minuit


- Accès HTTPS pour le front et adminer :
    - Ajout du port 443 au service nginx
    - Modification des blocs server 80 pour faire une
        redirection 301
    - Ajout des blocs server 443 pour sécuriser les accès